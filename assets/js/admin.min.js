var ajaxurl=meta_image.ajaxurl,init={onReady:function(){init.imageUploader(),init.ordering(),init.removeItem()},imageUploader:function(){var t;jQuery(".upload-image").click(function(e){e.preventDefault();var a=jQuery(this),r=jQuery(this).parent().attr("data-post"),i=jQuery(this).parent().attr("data-type"),n=jQuery(".photoWrap").children().length;t=wp.media.frames.meta_image_frame=wp.media({title:meta_image.title,button:{text:meta_image.button},library:{type:"image, video"},multiple:!1}),t.open(),t.on("select",function(){var e=t.state().get("selection").first().toJSON();jQuery('div[data-type="'+i+'"] .photoWrap').append('<li class="photo ui-state-default" data-order="'+n+'"><img src="'+e.url+'" alt="" /><span class="button button-remove remove-photo">X</span></li>'),init.saveImage(r,i,e.url),t.close()})})},saveImage:function(t,e,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{postID:t,type:e,fieldVal:a,action:"setImage"},dataType:"html",success:function(){init.removeItem()},error:function(t,e,a){window.alert(t+" :: "+e+" :: "+a)}})},removeItem:function(t,e,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{action:"removeItem",postID:t,type:a,key:e},dataType:"html",error:function(t,e,a){window.alert(t+" :: "+e+" :: "+a)}}),jQuery(".button-remove").click(function(t){t.preventDefault();var e=jQuery(this).parent().parent().attr("data-post"),a=jQuery(this).parent().parent().attr("data-type"),r=jQuery(this).parent().attr("data-key");jQuery(this).parent().remove(),init.removeItem(e,r,a),init.imageUploader()})},saveOrder:function(t,e,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{order:t,type:e,postID:a,action:"setOrder"},dataType:"JSON"})},ordering:function(){jQuery(".sortable").sortable({placeholder:"ui-state-highlight",update:function(t,e){var a=jQuery(this).attr("data-post"),r=jQuery(this).attr("data-type"),i=[];jQuery('div[data-type="'+r+'"] .sortable li').each(function(){i.push(jQuery(this).attr("data-order"))}),init.saveOrder(i,r,a)}}),jQuery(".sortable").disableSelection()}};jQuery(document).ready(function(){init.onReady()});